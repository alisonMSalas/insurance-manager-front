<p-tabView [(activeIndex)]="activeIndex">
  <!-- 1. Datos del Cliente -->
  <p-tabPanel header="Datos del Cliente">
    <form [formGroup]="clienteForm" class="form-grid">
      <div class="form-group full-width">
        <label for="buscar">Buscar Cliente</label>
        <div class="p-inputgroup">
          <input id="buscar" type="text" pInputText formControlName="buscar" placeholder="Ingrese cédula" maxlength="10"
            pattern="[0-9]*" inputmode="numeric" />
          <button pButton icon="pi pi-search" type="button" (click)="buscarCliente()"></button>
        </div>
        <small *ngIf="clienteForm.get('buscar')?.touched && clienteForm.get('buscar')?.errors?.['cedulaInvalida']"
          class="p-error">Cédula inválida</small>
      </div>

      <div class="form-group">
        <label for="cedula">Número de Documento</label>
        <input id="cedula" type="text" pInputText formControlName="cedula" readonly />
      </div>

      <div class="form-group">
        <label for="nombres">Nombres</label>
        <input id="nombres" type="text" pInputText formControlName="nombres" readonly />
      </div>

      <div class="form-group">
        <label for="apellidos">Apellidos</label>
        <input id="apellidos" type="text" pInputText formControlName="apellidos" readonly />
      </div>

      <div class="form-group">
        <label for="fechaNacimiento">Fecha de Nacimiento</label>
        <p-calendar formControlName="fechaNacimiento" dateFormat="dd/mm/yy" [showIcon]="true" inputId="fechaNacimiento"
          readonlyInput></p-calendar>
      </div>

      <div class="form-group">
        <label for="genero">Género</label>
        <input id="genero" type="text" pInputText formControlName="genero" readonly />
      </div>

      <div class="form-group">
        <label for="ocupacion">Ocupación</label>
        <input id="ocupacion" type="text" pInputText formControlName="ocupacion" readonly />
      </div>

      <div class="form-group">
        <label for="telefono">Teléfono</label>
        <input id="telefono" type="text" pInputText formControlName="telefono" readonly />
      </div>

      <div class="form-group">
        <label for="correo">Correo Electrónico</label>
        <input id="correo" type="email" pInputText formControlName="correo" readonly />
      </div>

      <div class="form-group full-width">
        <label for="direccion">Dirección</label>
        <input id="direccion" type="text" pInputText formControlName="direccion" readonly />
      </div>

      <div class="navigation-buttons">
        <button pButton label="Continuar" (click)="siguientePaso()" class="p-button-primary"></button>
      </div>
    </form>
    <p-toast></p-toast>
  </p-tabPanel>

  <!-- 2. Coberturas -->
  <p-tabPanel header="Coberturas y Beneficiario">
    <form [formGroup]="coberturasForm" class="form-layout">
      <div class="form-group full-width">
        <label for="tipoSeguro"><strong>Cobertura</strong></label>
        <p-dropdown [options]="tiposSeguro" optionLabel="name" formControlName="tipoSeguro" placeholder="Seleccione..."
          (onChange)="onTipoSeguroSeleccionado($event.value)"></p-dropdown>
      </div>

      <div class="field" style="display: flex; gap: 1rem;">
        <div style="flex: 1;">
          <label for="fechaInicio">Fecha de inicio de cobertura</label>
          <p-calendar formControlName="fechaInicio" dateFormat="dd/mm/yy" [showIcon]="true"
            placeholder="Fecha inicio"></p-calendar>
          <small *ngIf="coberturasForm.get('fechaInicio')?.errors?.['fechaPasada']" class="p-error">
            La fecha de inicio no puede ser anterior a hoy.
          </small>
        </div>

        <div style="flex: 1;">
          <label for="periodicidad">Periodicidad</label>
          <input id="periodicidad" type="text" pInputText formControlName="periodicidad" readonly />
        </div>
      </div>

      <div class="form-group full-width">
        <label for="beneficiario"><strong>Beneficiario</strong></label>
        <input id="beneficiario" type="text" pInputText formControlName="beneficiario"
          placeholder="Nombre del beneficiario" />
        <small
          *ngIf="coberturasForm.get('beneficiario')?.touched && coberturasForm.get('beneficiario')?.errors?.['required']"
          class="p-error">El nombre del beneficiario es requerido</small>
      </div>
    </form>

    <div class="navigation-buttons">
      <button pButton label="Regresar" (click)="activeIndex = 0" class="p-button-secondary"></button>
      <button pButton label="Continuar" (click)="siguientePaso()" class="p-button-primary"></button>
    </div>
  </p-tabPanel>

  <!-- 3. Documentos -->
  <p-tabPanel header="Documentos Requeridos">
    <div class="p-mb-3">
      <h3>Documentación Necesaria</h3>
      <p class="instructions">
        Adjunte su cédula de identidad (PDF, JPG o PNG – máximo 2MB).
      </p>
    </div>

    <form [formGroup]="documentosForm">
      <div class="p-field p-card p-p-3">
        <i class="pi pi-file-pdf doc-icon"></i>
        <label class="p-mb-2"><strong>Cédula de Identidad</strong></label>
        <p class="doc-description">Copia legible de ambos lados</p>

        <p-fileUpload name="cedula" [multiple]="true" accept=".pdf,.jpg,.png" [maxFileSize]="2000000" mode="advanced"
          [customUpload]="true" (uploadHandler)="onUpload($event)" chooseLabel="Seleccionar archivo">
          <ng-template pTemplate="content">
            <ul *ngIf="uploadedFiles.length">
              <li *ngFor="let file of uploadedFiles">
                {{ file.name }} - {{ file.size }} bytes
                <button pButton icon="pi pi-times" class="p-button-rounded p-button-danger p-button-text p-ml-2"
                  (click)="removeFile(file)"></button>
              </li>
            </ul>
          </ng-template>
        </p-fileUpload>
      </div>

      <div class="navigation-buttons">
        <button pButton label="Regresar" (click)="activeIndex = 1" class="p-button-secondary"></button>
        <button pButton label="Continuar" (click)="siguientePaso()" class="p-button-primary"></button>
      </div>
    </form>
  </p-tabPanel>

  <!-- 4. Datos de Pago -->
  <p-tabPanel header="Datos de Pago">
    <form [formGroup]="pagoForm" class="form-layout">
      <div class="form-grid">
        <div class="form-group">
          <label for="tipoPago">Tipo de Pago</label>
          <p-dropdown [options]="tiposPago" formControlName="tipoPago" optionLabel="label" optionValue="value"
            placeholder="Seleccione..."></p-dropdown>
        </div>

        <div class="form-group">
          <label for="monto">Monto</label>
          <input type="number" pInputText formControlName="monto" readonly />
        </div>

        <div class="form-group">
          <label for="fechaPago">Fecha de Pago</label>
          <p-calendar formControlName="fechaPago" dateFormat="dd/mm/yy" [showIcon]="true" readonlyInput></p-calendar>
        </div>

        <div class="navigation-buttons full-width">
          <button pButton label="Regresar" (click)="activeIndex = 2" class="p-button-secondary"></button>
          <button pButton label="Continuar" (click)="siguientePaso()" class="p-button-primary"></button>
        </div>
      </div>
    </form>
  </p-tabPanel>

  <!-- 5. Resumen -->
  <p-tabPanel header="Resumen">
    <div class="resumen-container">
      <section class="resumen-section">
        <h3>Datos del Cliente</h3>
        <ul class="resumen-list">
          <li><strong>Cédula:</strong> {{ clienteForm.get('cedula')?.value || '-' }}</li>
          <li><strong>Nombres:</strong> {{ clienteForm.get('nombres')?.value || '-' }}</li>
          <li><strong>Apellidos:</strong> {{ clienteForm.get('apellidos')?.value || '-' }}</li>
          <li><strong>Fecha de Nacimiento:</strong> {{ formatoFecha(clienteForm.get('fechaNacimiento')?.value) || '-' }}
          </li>
          <li><strong>Género:</strong> {{ clienteForm.get('genero')?.value || '-' }}</li>
          <li><strong>Ocupación:</strong> {{ clienteForm.get('ocupacion')?.value || '-' }}</li>
          <li><strong>Teléfono:</strong> {{ clienteForm.get('telefono')?.value || '-' }}</li>
          <li><strong>Correo:</strong> {{ clienteForm.get('correo')?.value || '-' }}</li>
          <li><strong>Dirección:</strong> {{ clienteForm.get('direccion')?.value || '-' }}</li>
        </ul>
      </section>

      <section class="resumen-section">
        <h3>Coberturas y Beneficiario</h3>
        <p><strong>Tipo de Seguro:</strong> {{ coberturasForm.get('tipoSeguro')?.value?.name || '-' }}</p>
        <p><strong>Fecha Inicio:</strong> {{ formatoFecha(coberturasForm.get('fechaInicio')?.value) || '-' }}</p>
        <p><strong>Periodicidad:</strong> {{ coberturasForm.get('periodicidad')?.value || '-' }}</p>
        <p><strong>Beneficiario:</strong> {{ coberturasForm.get('beneficiario')?.value || '-' }}</p>
      </section>

      <section class="resumen-section">
        <h3>Documentos</h3>
        <ng-container *ngIf="uploadedFiles.length > 0; else sinArchivo">
          <strong>Archivos cargados:</strong>
          <ul>
            <li *ngFor="let file of uploadedFiles">{{ file.name }}</li>
          </ul>
        </ng-container>
        <ng-template #sinArchivo>
          <p>No se han cargado archivos.</p>
        </ng-template>
      </section>

    </div>

    <div class="navigation-buttons">
      <button pButton label="Regresar" (click)="activeIndex = 3" class="p-button-secondary"></button>
      <button pButton label="Finalizar" (click)="finalizarProceso()" class="p-button-success"></button>
    </div>
  </p-tabPanel>
</p-tabView>