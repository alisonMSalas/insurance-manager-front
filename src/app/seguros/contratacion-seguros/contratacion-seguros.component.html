<p-tabView [(activeIndex)]="activeIndex">
  <!-- 1. Datos del Cliente -->
  <p-tabPanel header="Datos del Cliente">
    <form [formGroup]="clienteForm" class="form-grid">
      <!-- Buscar Cliente (toda la fila) -->
      <div class="form-group full-width">
        <label for="buscar">Buscar Cliente</label>
        <div class="p-inputgroup">
          <input id="buscar" type="text" pInputText formControlName="buscar" placeholder="Ingrese cédula" maxlength="10"
            pattern="[0-9]*" inputmode="numeric" />
          <button pButton icon="pi pi-search" type="button" (click)="buscarCliente()"></button>
        </div>
        <small *ngIf="clienteForm.get('buscar')?.touched && clienteForm.get('buscar')?.errors?.['cedulaInvalida']"
          class="p-error" style="color: red;">Cédula inválida</small>
      </div>

      <div class="form-group">
        <label for="cedula">Número de Documento</label>
        <input id="cedula" type="text" pInputText formControlName="cedula" [readonly]="true" />
      </div>

      <div class="form-group">
        <label for="nombres">Nombres</label>
        <input id="nombres" type="text" pInputText formControlName="nombres" [readonly]="true" />
      </div>

      <div class="form-group">
        <label for="apellidos">Apellidos</label>
        <input id="apellidos" type="text" pInputText formControlName="apellidos" [readonly]="true" />
      </div>

      <div class="form-group">
        <label for="fechaNacimiento">Fecha de Nacimiento</label>
        <p-calendar formControlName="fechaNacimiento" dateFormat="dd/mm/yy" [showIcon]="true" inputId="fechaNacimiento"
          [readonlyInput]="true"></p-calendar>
      </div>

      <div class="form-group">
        <label for="genero">Género</label>
        <input id="genero" type="text" pInputText formControlName="genero" [readonly]="true" />
      </div>

      <div class="form-group">
        <label for="ocupacion">Ocupación</label>
        <input id="ocupacion" type="text" pInputText formControlName="ocupacion" [readonly]="true" />
      </div>

      <div class="form-group">
        <label for="telefono">Teléfono</label>
        <input id="telefono" type="text" pInputText formControlName="telefono" [readonly]="true" />
      </div>

      <div class="form-group">
        <label for="correo">Correo Electrónico</label>
        <input id="correo" type="email" pInputText formControlName="correo" [readonly]="true" />
      </div>

      <div class="form-group full-width">
        <label for="direccion">Dirección</label>
        <input id="direccion" type="text" pInputText formControlName="direccion" [readonly]="true" />
      </div>

      <div class="navigation-buttons single-button">
        <button pButton label="Continuar" (click)="activeIndex = 1" (click)="siguientePaso()"
          class="p-button-primary"></button>
      </div>

    </form>
    <p-toast></p-toast>

  </p-tabPanel>



  <!-- 2. Coberturas -->
  <p-tabPanel header="Coberturas y Beneficiarios">
    <form [formGroup]="coberturasForm" class="form-layout">

      <div class="form-group full-width" style="margin-bottom: 1.5rem;">
        <label for="tipoSeguro"><strong>Cobertura</strong></label><br>
        <p-dropdown [options]="tiposSeguro" optionLabel="name" formControlName="tipoSeguro" placeholder="Seleccione..."
          (onChange)="onTipoSeguroSeleccionado($event.value)">
        </p-dropdown>

      </div>

      <div class="field" style="display: flex; gap: 1rem; margin-bottom: 2rem;">
        <div style="flex: 1;">
          <label for="fechaInicio">Fecha de inicio de cobertura</label><br>
          <div class="p-datepicker ">
            <p-calendar formControlName="fechaInicio" placeholder="Fecha inicio"></p-calendar>
            <div *ngIf="coberturasForm.get('fechaInicio')?.errors?.['fechaPasada']">
              <small class="p-error">La fecha de inicio no puede ser anterior a hoy.</small>
            </div>
          </div>

        </div>

        <div style="flex: 1;">
          <label for="fechaFin">Periodo de Pago</label><br>
          <input id="direccion" type="text" pInputText formControlName="periodicidad" [readonly]="true" />

        </div>
      </div>


    </form>

    <div style="margin-bottom: 1rem;">
      <label><strong>Beneficiarios</strong></label><br>
      <button pButton label="+ Agregar Beneficiario" (click)="agregarBeneficiario()" class="p-button-sm"
        style="margin-top: 0.5rem;"></button>
    </div>

    <p-table [value]="beneficiarios" class="custom-table">
      <ng-template pTemplate="header">
        <tr>
          <th>Nombre Completo</th>
          <th>Parentesco</th>
          <th>Porcentaje</th>
          <th>Acciones</th>
        </tr>
      </ng-template>
      <ng-template pTemplate="body" let-benef>
        <tr>
          <td><input type="text" pInputText [(ngModel)]="benef.nombre" name="nombre"></td>
          <td>
            <p-dropdown class="drop" #dropdownParentesco [options]="parentescos" [(ngModel)]="benef.parentesco"
              name="parentesco" [scrollHeight]="'100px'"></p-dropdown>
          </td>
          <td><input type="number" pInputText [(ngModel)]="benef.porcentaje" min="1" max="100" name="porcentaje"></td>
          <td><button pButton icon="pi pi-trash" (click)="eliminarBeneficiario(benef)"></button></td>
        </tr>
      </ng-template>
    </p-table>

    <div class="navigation-buttons">
      <button pButton label="Regresar" (click)="activeIndex = 0" class="p-button-secondary"></button>
      <button pButton label="Continuar" (click)="activeIndex = 2" class="p-button-primary"></button>
    </div>

  </p-tabPanel>

  <!-- 4. Documentos -->
  <p-tabPanel header="Documentos Requeridos">
    <div class="p-mb-3">
      <h3>Documentación Necesaria</h3>
      <p class="instructions">
        Para completar su solicitud, por favor adjunte su cédula de identidad (PDF, JPG o PNG – máximo 2MB).
      </p>
    </div>

    <form [formGroup]="documentosForm">
      <div class="p-field p-card p-p-3">
        <i class="pi pi-file-pdf doc-icon"></i>
        <label class="p-mb-2"><strong>Cédula de Identidad</strong></label>
        <p class="doc-description">Copia legible de ambos lados</p>

        <div class="card">
          <p-toast></p-toast>
          <p-fileupload #fileUpload name="cedula" url="https://www.primefaces.org/cdn/api/upload.php"
            (onUpload)="onUpload($event)" [multiple]="false" accept=".pdf,.jpg,.png" [maxFileSize]="2000000"
            mode="advanced" [auto]="true" chooseLabel="Seleccionar archivo">
            <ng-template pTemplate="content">
              <ul *ngIf="uploadedFiles.length">
                <li *ngFor="let file of uploadedFiles">
                  {{ file.name }} - {{ file.size }} bytes
                  <button pButton icon="pi pi-times" class="p-button-rounded p-button-danger p-button-text p-ml-2"
                    (click)="removeFile(file)"></button>
                </li>
              </ul>
            </ng-template>
          </p-fileupload>
        </div>
        <small *ngIf="mostrarError" class="p-error">
          <i class="pi pi-exclamation-triangle"></i> Documento requerido
        </small>
      </div>

      <div class="navigation-buttons">
        <button pButton label="Regresar" (click)="activeIndex = 1" class="p-button-secondary"></button>
        <button pButton label="Continuar" (click)="activeIndex = 3" (click)="validarDocumento()"
          class="p-button-primary"></button>
      </div>

    </form>
  </p-tabPanel>



  <!-- 4. Datos de Pago -->
  <p-tabPanel header="Datos de Pago">
    <form [formGroup]="pagoForm" class="form-layout">
      <div class="form-grid">
        <div class="form-group">
          <label for="tipo-pago">Tipo de Pago</label>
          <p-dropdown [options]="tiposPago" formControlName="tipoPago" placeholder="Seleccione..."></p-dropdown>
        </div>

        <div class="form-group">
          <label for="monto">Monto</label>
          <input type="number" pInputText formControlName="monto" min="1" readOnly="true" />
        </div>

        <div class="form-group">
          <label for="fecha">Fecha de Pago</label>
          <p-calendar formControlName="fechaPago" dateFormat="dd/mm/yy" [readonlyInput]="true" (onFocus)="false"
            (onClick)="false"></p-calendar>
        </div>

        <div class="navigation-buttons full-width">
          <button pButton type="button" label="Regresar" (click)="activeIndex = 2" class="p-button-secondary"></button>
          <button pButton type="button" label="Continuar" (click)="activeIndex = 4" class="p-button-primary"></button>
        </div>

      </div>
    </form>
  </p-tabPanel>


  <!-- 5. Resumen -->
  <p-tabPanel header="Resumen">

    <div class="resumen-container">

      <section class="resumen-section">
        <h3>Datos del Cliente</h3>
        <ul class="resumen-list">
          <li><strong>Cédula:</strong> {{ clienteForm.get('cedula')?.value || '-' }}</li>
          <li><strong>Nombres:</strong> {{ clienteForm.get('nombres')?.value || '-' }}</li>
          <li><strong>Apellidos:</strong> {{ clienteForm.get('apellidos')?.value || '-' }}</li>
          <li><strong>Fecha de Nacimiento:</strong> {{ formatoFecha(clienteForm.get('fechaNacimiento')?.value) || '-' }}
          </li>
          <li><strong>Género:</strong> {{ clienteForm.get('genero')?.value || '-' }}</li>
          <li><strong>Ocupación:</strong> {{ clienteForm.get('ocupacion')?.value || '-' }}</li>
          <li><strong>Teléfono:</strong> {{ clienteForm.get('telefono')?.value || '-' }}</li>
          <li><strong>Correo:</strong> {{ clienteForm.get('correo')?.value || '-' }}</li>
          <li><strong>Dirección:</strong> {{ clienteForm.get('direccion')?.value || '-' }}</li>
        </ul>
      </section>

      <section class="resumen-section">
        <h3>Coberturas y Beneficiarios</h3>
        <p><strong>Tipo de Seguro:</strong> {{ coberturasForm.get('tipoSeguro')?.value?.name || '-' }}</p>
        <p><strong>Fecha Inicio:</strong> {{ formatoFecha(coberturasForm.get('fechaInicio')?.value) || '-' }}</p>
        <p><strong>Periodicidad:</strong> {{ coberturasForm.get('periodicidad')?.value || '-' }}</p>

        <h4>Beneficiarios</h4>
        <p-table [value]="beneficiarios" [paginator]="true" [rows]="5" [responsiveLayout]="'scroll'">
          <ng-template pTemplate="header">
            <tr>
              <th>Nombre Completo</th>
              <th>Parentesco</th>
              <th>Porcentaje</th>
            </tr>
          </ng-template>
          <ng-template pTemplate="body" let-benef>
            <tr>
              <td>{{ benef.nombre }}</td>
              <td>{{ benef.parentesco?.name || benef.parentesco }}</td>
              <td>{{ benef.porcentaje }}%</td>
            </tr>
          </ng-template>
        </p-table>
      </section>

      <section class="resumen-section">
        <h3>Documentos</h3>
        <p *ngIf="uploadedFiles.length; else sinArchivo">
          <strong>Archivos cargados:</strong>
        <ul>
          <li *ngFor="let file of uploadedFiles">{{ file.name }}</li>
        </ul>

        <ng-template #sinArchivo>
          <p>No se han cargado archivos.</p>
        </ng-template>
      </section>

      <section class="resumen-section">
        <h3>Datos de Pago</h3>
        <p><strong>Tipo de Pago:</strong> {{ getLabelTipoPago() }}</p>

        <p><strong>Monto:</strong> {{ pagoForm.get('monto')?.value || '-' }}</p>
        <p><strong>Fecha de Pago:</strong> {{ formatoFecha(pagoForm.get('fechaPago')?.value) || '-' }}</p>
      </section>

    </div>

    <div class="navigation-buttons">
      <button pButton label="Regresar" (click)="activeIndex = 3" class="p-button-secondary"></button>
      <button pButton label="Finalizar" (click)="finalizarProceso()" class="p-button-success"></button>
    </div>

  </p-tabPanel>

</p-tabView>