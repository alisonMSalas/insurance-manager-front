<div class="content-area">
  <div class="insurance-header">
    <div>
      <div class="text-2xl text-white">Reportes</div>
    </div>
  </div>
  <p-divider></p-divider>

  <div class="content-container">
    <div class="reportes-container">
      <h2 class="mb-4">Selecciona un reporte</h2>
      <div class="tarjetas-grid">
        <p-card *ngFor="let tarjeta of tarjetas"
          class="tarjeta color-{{ tarjeta.colorFondo }} {{ tarjeta.titulo === reporteSeleccionado ? 'seleccionada' : '' }}"
          (click)="seleccionarTarjeta(tarjeta)" [style]="{ cursor: 'pointer' }">

          <ng-template pTemplate="header">
            <div class="tarjeta-encabezado">
              <i [class]="tarjeta.icono" [ngClass]="'text-' + tarjeta.colorIcono"></i>
              <span class="cantidad">{{ tarjeta.cantidad }}</span>
            </div>
          </ng-template>
          <div class="contenido">
            <h4>{{ tarjeta.titulo }}</h4>
            <p>{{ tarjeta.descripcion }}</p>
            <small>{{ tarjeta.fecha }}</small>
          </div>
        </p-card>
      </div>

      <p-divider></p-divider>
      <h2 class="mt-4 mb-2">Tabla de reportes</h2>
      <div class="nombre-reporte">
        <h3>{{ reporteSeleccionado ? reporteSeleccionado : 'Resumen de reportes' }}</h3>
      </div>

      <!-- Tabla para "Contratos por Cliente" -->
      <p-table *ngIf="reporteSeleccionado === 'Contratos por Cliente'" [value]="contratosFiltrados" [paginator]="true"
        [rows]="5" class="tabla-reportes">
        <ng-template pTemplate="header">
          <tr>
            <th>Cliente</th>
            <th>Cantidad de Contratos</th>
            <th>Acciones</th>
          </tr>
        </ng-template>
        <ng-template pTemplate="body" let-cliente>
          <tr>
            <td>{{ cliente.clientName || cliente.client?.name || '-' }}</td>
            <td>{{ cliente.contracts?.length || 0 }}</td>
            <td>
              <button pButton pRipple icon="pi pi-eye" class="p-button-text p-button-info" aria-label="Ver contratos"
                (click)="abrirModalCliente(cliente)"></button>
            </td>
          </tr>
        </ng-template>
      </p-table>

      <!-- Tabla para los demÃ¡s reportes -->
      <p-table *ngIf="reporteSeleccionado !== 'Contratos por Cliente' && contratosFiltrados.length > 0"
        [value]="contratosFiltrados" [paginator]="true" [rows]="5" class="tabla-reportes">
        <ng-template pTemplate="header">
          <tr>
            <th>Cliente</th>
            <th>Seguro</th>
            <th>Inicio</th>
            <th>Estado</th>
            <th>Monto</th>
            <th>Beneficiarios</th>
            <th>Acciones</th>
          </tr>
        </ng-template>
        <ng-template pTemplate="body" let-contrato>
          <tr>
            <td>{{ (contrato.client?.lastName + ' ' + contrato.client?.name) || '-' }}</td>
            <td>{{ contrato.insurance?.name || '-' }}</td>
            <td>{{ formatFecha(contrato.startDate) }}</td>
            <td>
              <p-chip [label]="formatStatus(contrato.status)"
                [styleClass]="'status-' + contrato.status?.toLowerCase()"></p-chip>
            </td>
            <td>{{ contrato.totalPaymentAmount !== undefined ? contrato.totalPaymentAmount : '-' }}</td>
            <td>{{ formatBeneficiaries(contrato.beneficiaries) }}</td>
            <td>
              <button pButton pRipple icon="pi pi-file-pdf" class="p-button-text p-button-danger"
                aria-label="Generar PDF" (click)="abrirPdfContrato(contrato.id)"></button>
            </td>
          </tr>
        </ng-template>
      </p-table>


      <!-- Modal para contratos del cliente -->
      <p-dialog header="Contratos del cliente" [(visible)]="modalVisible" [modal]="true" [style]="{width: '70vw'}"
        [closable]="true" (onHide)="cerrarModal()">
        <ng-container *ngIf="clienteSeleccionado">
          <p-table [value]="clienteSeleccionado.contracts" [paginator]="true" [rows]="5" class="tabla-reportes">
            <ng-template pTemplate="header">
              <tr>
                <th>ID</th>
                <th>Seguro</th>
                <th>Inicio</th>
                <th>Estado</th>
                <th>Monto</th>
                <th>Beneficiarios</th>
                <th>Acciones</th>
              </tr>
            </ng-template>
            <ng-template pTemplate="body" let-contrato>
              <tr>
                <td>{{ contrato.id }}</td>
                <td>{{ contrato.insurance?.name || '-' }}</td>
                <td>{{ formatFecha(contrato.startDate) }}</td>
                <td>
                  <p-chip [label]="formatStatus(contrato.status)"
                    [styleClass]="'status-' + contrato.status?.toLowerCase()"></p-chip>
                </td>
                <td>{{ contrato.totalPaymentAmount !== undefined ? contrato.totalPaymentAmount : '-' }}</td>
                <td>{{ formatBeneficiaries(contrato.beneficiaries) }}</td>
                <td>
                  <button pButton pRipple icon="pi pi-file-pdf" class="p-button-text p-button-danger p-button-plain"
                    aria-label="Generar PDF" (click)="abrirPdfContrato(contrato.id)"></button>


                </td>
              </tr>
            </ng-template>
          </p-table>
        </ng-container>
      </p-dialog>

      


    </div>
  </div>
</div>